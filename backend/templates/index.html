<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | TaskAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://api.fontshare.com/v2/css?f[]=general-sans@400,500,600,700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['General Sans', 'sans-serif'],
                    },
                    colors: {
                        bg: '#0B1220',
                        card: '#121A2A',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-bg text-white font-sans h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-[260px] h-full bg-card flex flex-col px-6 py-8 border-r border-white/5">
        <div class="flex items-center gap-3 mb-10 px-2">
            <i data-lucide="brain-circuit" class="w-6 h-6 text-indigo-400"></i>
            <span class="text-lg font-semibold text-indigo-400">TaskAI</span>
        </div>
        <nav class="flex flex-col gap-2">
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm bg-indigo-500/10 text-indigo-400 font-medium">
                <i data-lucide="layout-dashboard" class="w-[18px]"></i>
                Dashboard
            </a>
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-white/70 hover:bg-white/5 hover:text-white transition-colors">
                <i data-lucide="list-todo" class="w-[18px]"></i>
                My Tasks
            </a>
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-white/70 hover:bg-white/5 hover:text-white transition-colors">
                <i data-lucide="bar-chart-3" class="w-[18px]"></i>
                Analytics
            </a>
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm text-white/70 hover:bg-white/5 hover:text-white transition-colors">
                <i data-lucide="settings" class="w-[18px]"></i>
                Settings
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">

        <!-- Header -->
        <header class="flex items-center justify-between px-10 py-8 bg-bg">
            <div>
                <h1 class="text-2xl font-semibold text-white">Dashboard</h1>
                <p class="text-sm text-white/50 mt-1">Welcome back, User</p>
            </div>
            <div
                class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-medium ring-4 ring-indigo-500/20">
                U
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-10 py-8">

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-card rounded-xl p-6 border border-white/5">
                    <p class="text-sm text-white/50 mb-2">Total Tasks</p>
                    <p class="text-3xl font-semibold text-white" id="total-count">0</p>
                </div>
                <div class="bg-card rounded-xl p-6 border border-white/5">
                    <p class="text-sm text-white/50 mb-2">Pending</p>
                    <p class="text-3xl font-semibold text-amber-400" id="pending-count">0</p>
                </div>
                <div class="bg-card rounded-xl p-6 border border-white/5">
                    <p class="text-sm text-white/50 mb-2">Completed</p>
                    <p class="text-3xl font-semibold text-emerald-400" id="completed-count">0</p>
                </div>
            </div>

            <!-- Create Task -->
            <div class="bg-card rounded-xl p-6 mt-6 border border-white/5">
                <h3 class="text-white font-medium mb-4">Add New Task</h3>
                <div class="flex gap-4">
                    <div class="flex-1 flex flex-col gap-3">
                        <input type="text" id="task-title" placeholder="Task title"
                            class="w-full bg-bg text-white rounded-lg px-4 py-3 text-sm border border-white/5 focus:outline-none focus:border-indigo-500/50 transition-colors">
                        <input type="text" id="task-desc" placeholder="Description (optional)"
                            class="w-full bg-bg text-white rounded-lg px-4 py-3 text-sm border border-white/5 focus:outline-none focus:border-indigo-500/50 transition-colors">
                    </div>
                    <button onclick="createTask()"
                        class="bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg px-6 py-2 text-sm font-medium transition-colors flex items-center justify-center gap-2 h-fit self-start">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add Task
                    </button>
                </div>
            </div>

            <!-- Tasks -->
            <h2 class="text-lg font-semibold text-white mt-8 mb-4">Your Tasks</h2>
            <div id="task-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-10">
                <!-- Tasks injected here -->
            </div>

        </main>
    </div>

    <script>
        const API_URL = '/tasks';

        async function fetchTasks() {
            try {
                const response = await fetch(API_URL);
                const tasks = await response.json();
                renderTasks(tasks);
                updateStats(tasks);
            } catch (err) {
                console.error("Failed to fetch tasks", err);
            }
        }

        function updateStats(tasks) {
            document.getElementById('total-count').innerText = tasks.length;
            document.getElementById('pending-count').innerText = tasks.filter(t => t.status === 'pending').length;
            document.getElementById('completed-count').innerText = tasks.filter(t => t.status === 'completed').length;
        }

        function renderTasks(tasks) {
            const grid = document.getElementById('task-grid');
            grid.innerHTML = '';

            if (tasks.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-white/30 bg-card rounded-xl border border-white/5">No tasks found. Create one above to get started.</div>';
                return;
            }

            tasks.forEach(task => {
                const isCompleted = task.status === 'completed';
                const el = document.createElement('div');
                el.className = 'bg-card rounded-xl p-5 border border-white/5 hover:border-indigo-500/30 transition-all group flex flex-col justify-between h-full';

                let categoryBadge = '';
                if (task.category) {
                    let badgeColor = 'bg-slate-500/10 text-slate-400 border-slate-500/20';
                    if (task.category === 'Work') badgeColor = 'bg-amber-500/10 text-amber-400 border-amber-500/20';
                    if (task.category === 'Personal') badgeColor = 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20';
                    if (task.category === 'Study') badgeColor = 'bg-indigo-500/10 text-indigo-400 border-indigo-500/20';

                    categoryBadge = `<div class="text-[10px] px-2.5 py-1 rounded-full border \${badgeColor}">\${task.category}</div>`;
                }

                el.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-medium text-white \${isCompleted ? 'line-through opacity-50' : ''}">\${task.title}</h3>
                            \${categoryBadge}
                        </div>
                        <p class="text-sm text-white/50 line-clamp-2 mb-4">\${task.description || "No description provided."}</p>
                    </div>

                    <div class="flex items-center justify-between pt-4 border-t border-white/5">
                        <div class="flex items-center gap-2 text-xs text-white/40">
                            <i data-lucide="calendar" class="w-3 h-3"></i>
                            \${new Date(task.created_at).toLocaleDateString()}
                        </div>
                        
                        <div class="flex items-center gap-2">
                           <button onclick="categorizeTask(\${task.id})" \${task.category ? 'disabled' : ''} class="p-1.5 rounded-md transition-colors \${task.category ? 'text-indigo-400/50 cursor-default' : 'text-white/40 hover:text-indigo-400 hover:bg-indigo-500/10'}">
                               <i data-lucide="sparkles" class="w-4 h-4"></i>
                           </button>
                           <button onclick="toggleStatus(\${task.id}, '\${task.status}')" class="p-1.5 rounded-md transition-colors \${isCompleted ? 'text-emerald-400' : 'text-white/40 hover:text-emerald-400 hover:bg-emerald-500/10'}">
                               <i data-lucide="\${isCompleted ? 'check-circle-2' : 'circle'}" class="w-4 h-4"></i>
                           </button>
                           <button onclick="deleteTask(\${task.id})" class="p-1.5 rounded-md text-white/40 hover:text-red-400 hover:bg-red-500/10 transition-colors">
                               <i data-lucide="trash-2" class="w-4 h-4"></i>
                           </button>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });
            lucide.createIcons();
        }

        async function createTask() {
            const titleInput = document.getElementById('task-title');
            const descInput = document.getElementById('task-desc');

            if (!titleInput.value.trim()) return;

            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: titleInput.value, description: descInput.value })
            });

            titleInput.value = '';
            descInput.value = '';
            fetchTasks();
        }

        async function toggleStatus(id, currentStatus) {
            await fetch(`\${API_URL}/\${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: currentStatus === 'pending' ? 'completed' : 'pending' })
            });
            fetchTasks();
        }

        async function deleteTask(id) {
            if (!confirm('Delete this task?')) return;
            await fetch(`\${API_URL}/\${id}`, { method: 'DELETE' });
            fetchTasks();
        }

        async function categorizeTask(id) {
            await fetch(`\${API_URL}/\${id}/categorize`, { method: 'POST' });
            fetchTasks();
        }

        // Init
        lucide.createIcons();
        fetchTasks();
    </script>
</body>

</html>